**哈希技术**

+ 哈希技术：通过哈希函数将任意长度的输入(哈希键)映射为固定长度的输出(哈希值)。

**1.布隆过滤器**

**1.1基本原理**

+ 布隆过滤器：一种多哈希函数映射的数据结构。常用于判断一个元素是否在一个集合中，其返回的结果为"可能在集合中"和"肯定不在集合中"。利用多个不同的哈希函数解决哈希冲突。

+ 哈希冲突：多个输入被映射为同一个输出的哈希映射。

+ 符号说明：

  + 布隆过滤器为位数组$bitarray$
  + 数组大小为$m$
  + 哈希函数的个数为$k$
  + 第$i$个哈希函数为$h_i(x)$

  + 哈希函数的集合为$H(x)=\{h_1(x),...,h_k(x)\}$

+ 布隆过滤器的映射过程：

  + 插入元素$x$到集合$A$中，然后计算布隆过滤器的索引$index=H(x)=\{h_1(x),...,h_k(x)\}$，将数组对应的位置$bitarray[index]$置为$1$。
  + 判断元素$x$是否在集合$A$：计算数组的索引$index=H(x)=\{h_1(x),...,h_k(x)\}$，如果$bitarray[index]$都为$1$，那么$x$可能在集合$A$中；否则$x$一定不在集合$A$中。

**1.2误判率**

+ 布隆过滤器的误判率，插入$n$个元素，然后计算误判率。

  + 理论上，误判率=某元素被判断为可能在集合中但实际不在集合中的概率。
  + 实际上计算，误判率=某元素被判断为可能在集合中的概率。
+ 布隆过滤器数组的大小为$m$。
+ 哈希函数数量为$k$。
+ 假设每个哈希函数的哈希映射是完全随机的。
+ 每次插入元素，每个哈希函数选中数组中某位置的概率为$\frac{1}{m}$。
+ 每次插入元素，每个哈希函数没有选中数组中某位置的概率为$1-\frac{1}{m}$。
+ 插入$n$个元素后，数组中某位置没有被选中的概率为$P(b i t=0)=\left(1-\frac{1}{m}\right)^{k n} \approx e^{-\frac{k n}{m}}$。
+ 插入$n$个元素后，数组中某位置被选中的概率为$P(\text {bit}=1)=1-P(\text {bit}=0)=1-e^{-\frac{k n}{m}}$。
+ 判断元素是否在集合中，$k$个哈希函数都选中已置$1$的位置，则元素可能在集合中的概率为$P(bit=1)^k=(1-e^{-\frac{kn}{m}})^k$，即误判率。
+ 哈希函数数量$k$越大，布隆过滤器数组大小$m$越大，插入元素数量$n$越小，误判率越低。

**1.3控制误判率**

+ ①计算误判率最小时哈希函数的数量$k$
  $$
  令\rho=e^{-\frac{k n}{m}}\\
  则k=-\frac{m}{n} \ln (\rho)\\
  误判率为f=(1-\rho)^{k}=e^{k \ln (1-\rho)}\\
  再令g=k \ln (1-\rho)\\
  则g=-\frac{m}{n} \ln (\rho) \ln (1-\rho)\\
  当\rho=\frac{1}{2},k=\frac{m\ln2}{n}时,g最小\\
  此时误判率=(1-\rho)^{k}\approx(0.6185)^{\frac{m}{n}}
  $$
  说明：$\rho$即插入$n$个元素后，数组中某位置没有被选中的概率。所以如果确定了哈希函数函数最优数量$k$，那么插入$n$元素后，数组中大约有$\frac{1}{2}m$的位置没有被选中。

+ ②给定最大误判率$\epsilon$，插入$n$个元素，计算布隆过滤器位数组的最少位数$m$
  $$
  m\geq n\log\frac{1}{\epsilon}
  $$

+ ③给定最大误判率$\epsilon$和最优哈希函数数量$k=\frac{m\ln2}{n}$，插入$n$个元素，计算布隆过滤器最少位数$m$

$$
m\geq n\log\frac{1}{(\ln2)\epsilon}
$$

**1.4应用**

+ 识别垃圾邮件地址和恶意链接。
+ 网页爬虫时对URL去重。